#!/bin/bash

# Save directory path
BASE_DIR="/home/amir/Documents/BashTasks/BashFinalProjectDBMS"

# Path to the FinalTable script
FINAL_TABLE_SCRIPT="$BASE_DIR/FinalTable"  # Make sure the path is correct

# Check if the database directory exists or not
if [[ ! -e "$BASE_DIR" ]]; then
    mkdir -p "$BASE_DIR"
    zenity --info --text="Database directory created."
fi

cd "$BASE_DIR" || exit
zenity --info --text="Connected to database directory. " 

# Main menu
while true; do
    choice=$(zenity --list --title="Main Menu" --radiolist \
    --column="Select" --column="Option" \
    TRUE "Create Database" \
    FALSE "List Databases" \
    FALSE "Connect To Database" \
    FALSE "Drop Database" \
    FALSE "Exit" --width=700 --height=500)

    case $choice in
    "Create Database") # Create database
        DBName=$(zenity --entry --text="Please enter database name:")
        if [[ -z $DBName || ! $DBName =~ ^[a-zA-Z][a-zA-Z0-9_]*[a-zA-Z0-9]$ ]]; then
            zenity --error --text="Invalid database name. Use only letters, numbers, and underscores. Must start with a letter and not end with an underscore."
        elif [[ -e $DBName ]]; then
            zenity --error --text="Database '$DBName' already exists."
        else
            mkdir "$DBName"
            zenity --info --text="Database '$DBName' created successfully."
        fi
        ;;
    "List Databases") # Print and list all databases
        databases=$(ls -d */)
        if [[ -z $databases ]]; then
            zenity --info --text="No databases found."
        else
            zenity --info --text="Databases:\n$databases"
        fi
        ;;
    "Connect To Database") # Connect to database
        DBName=$(zenity --entry --text="Please enter database name:")
        if [[ -z $DBName || ! -d $DBName ]]; then
            zenity --error --text="Database '$DBName' does not exist."
        else
            cd "$DBName" || exit
            zenity --info --text="Connected to database '$DBName'."

            # Source the table operations script
            if [[ -f $FINAL_TABLE_SCRIPT ]]; then
                source "$FINAL_TABLE_SCRIPT"
            else
                zenity --error --text="Error: FinalTable script not found at $FINAL_TABLE_SCRIPT"
            fi

            cd "$BASE_DIR" || exit
        fi
        ;;
    "Drop Database") # Drop database
        DBName=$(zenity --entry --text="Enter database name to drop:")
        if [[ -z $DBName || ! -d $DBName ]]; then
            zenity --error --text="Database '$DBName' does not exist."
        else
            rm -r "$DBName"
            zenity --info --text="Database '$DBName' dropped successfully."
        fi
        ;;
    "Exit") # Exit
        zenity --info --text="Exiting the program."
        break
        ;;
    *) # Invalid Option
        zenity --error --text="Invalid choice. Please select a valid option."
        ;;
    esac
done

